<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PSF classes &mdash; Piff 1.4.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Removing Outliers" href="outliers.html" />
    <link rel="prev" title="Interpolation Schemes" href="interp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Piff
          </a>
              <div class="version">
                1.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">PIFF: PSFs In the Full FOV</a></li>
<li class="toctree-l1"><a class="reference internal" href="piffify.html">The piffify executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Reading in Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="select.html">Selecting Good PSF Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="interp.html">Interpolation Schemes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PSF classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#piff.PSF"><code class="docutils literal notranslate"><span class="pre">PSF</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF._write"><code class="docutils literal notranslate"><span class="pre">PSF._write()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF._read"><code class="docutils literal notranslate"><span class="pre">PSF._read()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.draw"><code class="docutils literal notranslate"><span class="pre">PSF.draw()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.drawStar"><code class="docutils literal notranslate"><span class="pre">PSF.drawStar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.drawStarList"><code class="docutils literal notranslate"><span class="pre">PSF.drawStarList()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.fit"><code class="docutils literal notranslate"><span class="pre">PSF.fit()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.fit_center"><code class="docutils literal notranslate"><span class="pre">PSF.fit_center</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.get_profile"><code class="docutils literal notranslate"><span class="pre">PSF.get_profile()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.include_model_centroid"><code class="docutils literal notranslate"><span class="pre">PSF.include_model_centroid</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.initialize_flux_center"><code class="docutils literal notranslate"><span class="pre">PSF.initialize_flux_center()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.initialize_params"><code class="docutils literal notranslate"><span class="pre">PSF.initialize_params()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.interpolateStar"><code class="docutils literal notranslate"><span class="pre">PSF.interpolateStar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.interpolateStarList"><code class="docutils literal notranslate"><span class="pre">PSF.interpolateStarList()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.parseKwargs"><code class="docutils literal notranslate"><span class="pre">PSF.parseKwargs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.process"><code class="docutils literal notranslate"><span class="pre">PSF.process()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.read"><code class="docutils literal notranslate"><span class="pre">PSF.read()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.readWCS"><code class="docutils literal notranslate"><span class="pre">PSF.readWCS()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.reflux"><code class="docutils literal notranslate"><span class="pre">PSF.reflux()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.reflux_stars"><code class="docutils literal notranslate"><span class="pre">PSF.reflux_stars()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.remove_outliers"><code class="docutils literal notranslate"><span class="pre">PSF.remove_outliers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.set_num"><code class="docutils literal notranslate"><span class="pre">PSF.set_num()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.single_iteration"><code class="docutils literal notranslate"><span class="pre">PSF.single_iteration()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.write"><code class="docutils literal notranslate"><span class="pre">PSF.write()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#piff.PSF.writeWCS"><code class="docutils literal notranslate"><span class="pre">PSF.writeWCS()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-simple-case-of-one-model-interp">The simple case of one model/interp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#piff.SimplePSF"><code class="docutils literal notranslate"><span class="pre">SimplePSF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF._finish_write"><code class="docutils literal notranslate"><span class="pre">SimplePSF._finish_write()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF._finish_read"><code class="docutils literal notranslate"><span class="pre">SimplePSF._finish_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.fit_center"><code class="docutils literal notranslate"><span class="pre">SimplePSF.fit_center</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.include_model_centroid"><code class="docutils literal notranslate"><span class="pre">SimplePSF.include_model_centroid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.initialize_params"><code class="docutils literal notranslate"><span class="pre">SimplePSF.initialize_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.interpolateStar"><code class="docutils literal notranslate"><span class="pre">SimplePSF.interpolateStar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.interpolateStarList"><code class="docutils literal notranslate"><span class="pre">SimplePSF.interpolateStarList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.parseKwargs"><code class="docutils literal notranslate"><span class="pre">SimplePSF.parseKwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.set_num"><code class="docutils literal notranslate"><span class="pre">SimplePSF.set_num()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SimplePSF.single_iteration"><code class="docutils literal notranslate"><span class="pre">SimplePSF.single_iteration()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-separate-solution-for-each-chip">Using a separate solution for each chip</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#piff.SingleChipPSF"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF._finish_write"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF._finish_write()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF._finish_read"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF._finish_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.fit"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.fit_center"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.fit_center</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.include_model_centroid"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.include_model_centroid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.interpolateStar"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.interpolateStar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.parseKwargs"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.parseKwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SingleChipPSF.set_num"><code class="docutils literal notranslate"><span class="pre">SingleChipPSF.set_num()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#composite-psf-types">Composite PSF types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#piff.SumPSF"><code class="docutils literal notranslate"><span class="pre">SumPSF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF._finish_write"><code class="docutils literal notranslate"><span class="pre">SumPSF._finish_write()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF._finish_read"><code class="docutils literal notranslate"><span class="pre">SumPSF._finish_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.fit_center"><code class="docutils literal notranslate"><span class="pre">SumPSF.fit_center</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.include_model_centroid"><code class="docutils literal notranslate"><span class="pre">SumPSF.include_model_centroid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.initialize_params"><code class="docutils literal notranslate"><span class="pre">SumPSF.initialize_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.interpolateStar"><code class="docutils literal notranslate"><span class="pre">SumPSF.interpolateStar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.interpolateStarList"><code class="docutils literal notranslate"><span class="pre">SumPSF.interpolateStarList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.parseKwargs"><code class="docutils literal notranslate"><span class="pre">SumPSF.parseKwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.set_num"><code class="docutils literal notranslate"><span class="pre">SumPSF.set_num()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.setup_params"><code class="docutils literal notranslate"><span class="pre">SumPSF.setup_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.SumPSF.single_iteration"><code class="docutils literal notranslate"><span class="pre">SumPSF.single_iteration()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#piff.ConvolvePSF"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF._finish_write"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF._finish_write()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF._finish_read"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF._finish_read()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.fit_center"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.fit_center</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.include_model_centroid"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.include_model_centroid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.initialize_params"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.initialize_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.interpolateStar"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.interpolateStar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.interpolateStarList"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.interpolateStarList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.parseKwargs"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.parseKwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.set_num"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.set_num()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.setup_params"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.setup_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#piff.ConvolvePSF.single_iteration"><code class="docutils literal notranslate"><span class="pre">ConvolvePSF.single_iteration()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="outliers.html">Removing Outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Writing the output file</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">Output statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="star.html">Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utility Functions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Piff</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PSF classes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/psf.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="psf-classes">
<h1>PSF classes<a class="headerlink" href="#psf-classes" title="Permalink to this heading"></a></h1>
<p>The <a class="reference internal" href="#piff.PSF" title="piff.PSF"><code class="xref any py py-class docutils literal notranslate"><span class="pre">PSF</span></code></a> classes define the interaction between the models and the interpolants.  The
simplest version <a class="reference internal" href="#piff.SimplePSF" title="piff.SimplePSF"><code class="xref any py py-class docutils literal notranslate"><span class="pre">SimplePSF</span></code></a> has one model and one interpolant, but it is possible to have
more complicated combinations of these.</p>
<dl class="py class">
<dt class="sig sig-object py" id="piff.PSF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">piff.</span></span><span class="sig-name descname"><span class="pre">PSF</span></span><a class="reference internal" href="_modules/piff/psf.html#PSF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF" title="Permalink to this definition"></a></dt>
<dd><p>The base class for describing a PSF model across a field of view.</p>
<p>The usual way to create a PSF is through one of the two factory functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</pre></div>
</div>
<p>The first is used to build a PSF model from the data according to a config dict.
The second is used to read in a PSF model from disk.</p>
<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF._write">
<span class="sig-name descname"><span class="pre">_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF._write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF._write" title="Permalink to this definition"></a></dt>
<dd><p>This is the function that actually does the work for the write function.
Composite PSF classes that need to iterate can call this multiple times as needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension with the psf information.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF._read">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF._read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF._read" title="Permalink to this definition"></a></dt>
<dd><p>This is the function that actually does the work for the read function.
Composite PSF classes that need to iterate can call this multiple times as needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension with the psf information.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.draw">
<span class="sig-name descname"><span class="pre">draw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chipnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stamp_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">48</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.draw"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.draw" title="Permalink to this definition"></a></dt>
<dd><p>Draws an image of the PSF at a given location.</p>
<p>The normal usage would be to specify (chipnum, x, y), in which case Piff will use the
stored wcs information for that chip to interpolate to the given position and draw
an image of the PSF:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">,</span> <span class="n">stamp_size</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
</pre></div>
</div>
<p>However, if the PSF interpolation used extra properties for the interpolation
(cf. psf.interp_property_names), you need to provide them as additional kwargs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">interp_property_names</span><span class="p">)</span>
<span class="go">(&#39;u&#39;,&#39;v&#39;,&#39;ri_color&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">,</span> <span class="n">ri_color</span><span class="o">=</span><span class="mf">0.23</span><span class="p">,</span> <span class="n">stamp_size</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
</pre></div>
</div>
<p>Normally, the image is constructed automatically based on stamp_size, in which case
the WCS will be taken to be the local Jacobian at this location on the original image.
However, if you provide your own image using the :image: argument, then whatever WCS
is present in that image will be respected.  E.g. if you want an image of the PSF in
sky coordinates rather than image coordinates, you can provide an image with just a
pixel scale for the WCS.</p>
<p>When drawing the PSF, there are a few options regarding how the profile will be
centered on the image.</p>
<ol class="arabic simple">
<li><p>The default behavior (<code class="docutils literal notranslate"><span class="pre">center==None</span></code>) is to draw the profile centered at the same
(x,y) as you requested for the location of the PSF in the original image coordinates.
The returned image will not (normally) be as large as the full image – it will just be
a postage stamp centered roughly around (x,y).  The image.bounds give the bounding box
of this stamp, and within this, the PSF will be centered at position (x,y).</p></li>
<li><p>If you want to center the profile at some other arbitrary position, you may provide
a <code class="docutils literal notranslate"><span class="pre">center</span></code> parameter, which should be a tuple (xc,yc) giving the location at which
you want the PSF to be centered.  The bounding box will still be around the nominal
(x,y) position, so this should only be used for small adjustments to the (x,y) value
if you want it centered at a slightly different location.</p></li>
<li><p>If you provide your own image with the <code class="docutils literal notranslate"><span class="pre">image</span></code> parameter, then you may set the
<code class="docutils literal notranslate"><span class="pre">center</span></code> to any location in this box (or technically off it – it doesn’t check that
the center is actually inside the bounding box).  This may be useful if you want to draw
on an image with origin at (0,0) or (1,1) and just put the PSF at the location you want.</p></li>
<li><p>If you want the PSf centered exactly in the center of the image, then you can use
<code class="docutils literal notranslate"><span class="pre">center=True</span></code>.  This will work for either an automatically built image or one
that you provide.</p></li>
<li><p>With any of the above options you may additionally supply an <code class="docutils literal notranslate"><span class="pre">offset</span></code> parameter, which
will apply a slight offset to the calculated center.  This is probably only useful in
conjunction with the default <code class="docutils literal notranslate"><span class="pre">center=None</span></code> or <code class="docutils literal notranslate"><span class="pre">center=True</span></code>.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – The x position of the desired PSF in the original image coordinates.</p></li>
<li><p><strong>y</strong> – The y position of the desired PSF in the original image coordinates.</p></li>
<li><p><strong>chipnum</strong> – Which chip to use for WCS information. [required if the psf model
covers more than a single chip]</p></li>
<li><p><strong>flux</strong> – Flux of PSF to be drawn [default: 1.0]</p></li>
<li><p><strong>center</strong> – (xc,yc) tuple giving the location on the image where you want the
nominal center of the profile to be drawn.  Also allowed is the
value center=True to place in the center of the image.
[default: None, which means draw at the position (x,y) of the PSF.]</p></li>
<li><p><strong>offset</strong> – Optional (dx,dy) tuple giving an additional offset relative to the
center. [default: None]</p></li>
<li><p><strong>stamp_size</strong> – The size of the image to construct if no image is provided.
[default: 48]</p></li>
<li><p><strong>image</strong> – An existing image on which to draw, if desired. [default: None]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
<li><p><strong>**kwargs</strong> – Any additional properties required for the interpolation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A GalSim Image of the PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.drawStar">
<span class="sig-name descname"><span class="pre">drawStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.drawStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.drawStar" title="Permalink to this definition"></a></dt>
<dd><p>Generate PSF image for a given star.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the star already has the fit parameters calculated, then this will trust
those values and not redo the interpolation.  If this might be a concern, you can
force the interpolation to be redone by running</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">star</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">interpolateList</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
</pre></div>
</div>
<p>before running <a class="reference internal" href="#piff.PSF.drawStar" title="piff.PSF.drawStar"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">drawStar</span></code></a>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – Star instance holding information needed for interpolation as
well as an image/WCS into which PSF will be rendered.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its image filled with rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.drawStarList">
<span class="sig-name descname"><span class="pre">drawStarList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.drawStarList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.drawStarList" title="Permalink to this definition"></a></dt>
<dd><p>Generate PSF images for given stars. Takes advantage of
interpolateList for significant speedup with some interpolators.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the stars already have the fit parameters calculated, then this will trust
those values and not redo the interpolation.  If this might be a concern, you can
force the interpolation to be redone by running</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stars</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">interpolateList</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span>
</pre></div>
</div>
<p>before running <a class="reference internal" href="#piff.PSF.drawStarList" title="piff.PSF.drawStarList"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">drawStarList</span></code></a>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stars</strong> – List of Star instances holding information needed
for interpolation as well as an image/WCS into
which PSF will be rendered.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of Star instances with its image filled with
rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.fit" title="Permalink to this definition"></a></dt>
<dd><p>Fit interpolated PSF model to star data using standard sequence of operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>wcs</strong> – A dict of WCS solutions indexed by chipnum.</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord object giving the telescope pointing.
[Note: pointing should be None if the WCS is not a CelestialWCS]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  This is used by composite PSFs
to isolate the effect of just this model component.  If provided,
it should be the same length as stars. [default: None]</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If not given,
use the default method for the PSF model being fit. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.PSF.fit_center">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fit_center</span></span><a class="headerlink" href="#piff.PSF.fit_center" title="Permalink to this definition"></a></dt>
<dd><p>Whether to fit the center of the star in reflux.</p>
<p>This is generally set in the model specifications.
If all component models includes a shift, then this is False.
Otherwise it is True.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.get_profile">
<span class="sig-name descname"><span class="pre">get_profile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chipnum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.get_profile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.get_profile" title="Permalink to this definition"></a></dt>
<dd><p>Get the PSF profile at the given position as a GalSim GSObject.</p>
<p>The normal usage would be to specify (chipnum, x, y), in which case Piff will use the
stored wcs information for that chip to interpolate to the given position and draw
an image of the PSF:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">get_profile</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The first return value, prof, is the GSObject describing the PSF profile.
The second one, method, is the method parameter that should be used when drawing the
profile using <code class="docutils literal notranslate"><span class="pre">prof.drawImage(...,</span> <span class="pre">method=method)</span></code>.  This may be either ‘no_pixel’
or ‘auto’ depending on whether the PSF model already includes the pixel response or not.
Some underlying models includ the pixel response, and some don’t, so this difference needs
to be accounted for properly when drawing.  This method is also appropriate if you first
convolve the PSF by some other (e.g. galaxy) profile and then draw that.</p>
<p>If the PSF interpolation used extra properties for the interpolation (cf.
psf.interp_property_names), you need to provide them as additional kwargs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">interp_property_names</span><span class="p">)</span>
<span class="go">(&#39;u&#39;,&#39;v&#39;,&#39;ri_color&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prof</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">get_profile</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">,</span> <span class="n">ri_color</span><span class="o">=</span><span class="mf">0.23</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – The x position of the desired PSF in the original image coordinates.</p></li>
<li><p><strong>y</strong> – The y position of the desired PSF in the original image coordinates.</p></li>
<li><p><strong>chipnum</strong> – Which chip to use for WCS information. [required if the psf model
covers more than a single chip]</p></li>
<li><p><strong>flux</strong> – Flux of PSF model [default: 1.0]</p></li>
<li><p><strong>**kwargs</strong> – Any additional properties required for the interpolation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(profile, method)
profile = A GalSim GSObject of the PSF
method = either ‘no_pixel’ or ‘auto’ indicating which method to use
when drawing the profile on an image.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.PSF.include_model_centroid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">include_model_centroid</span></span><a class="headerlink" href="#piff.PSF.include_model_centroid" title="Permalink to this definition"></a></dt>
<dd><p>Whether a model that we want to center can have a non-zero centroid during iterations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.initialize_flux_center">
<span class="sig-name descname"><span class="pre">initialize_flux_center</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.initialize_flux_center"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.initialize_flux_center" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the flux and center of the stars.</p>
<p>The flux is just a simple sum of unmasked pixels.
The center is a simple centroid relative to the nominal position.  It is only updated
if the PSF model is centered. (I.e. if self.fit_center is True.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The initial list of Star instances that will be used to constrain
the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the initialized stars</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.initialize_params">
<span class="sig-name descname"><span class="pre">initialize_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.initialize_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.initialize_params" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the psf solver to begin an iterative solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The initial list of Star instances that will be used to constrain
the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress. [default: None]</p></li>
<li><p><strong>default_init</strong> – The default initilization method if the user doesn’t specify one.
[default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the initialized stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.interpolateStar">
<span class="sig-name descname"><span class="pre">interpolateStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.interpolateStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.interpolateStar" title="Permalink to this definition"></a></dt>
<dd><p>Update the star to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>star</strong> – Star instance to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.interpolateStarList">
<span class="sig-name descname"><span class="pre">interpolateStarList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.interpolateStarList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.interpolateStarList" title="Permalink to this definition"></a></dt>
<dd><p>Update the stars to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stars</strong> – List of Star instances to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of Star instances with their fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.parseKwargs">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parseKwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.parseKwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.parseKwargs" title="Permalink to this definition"></a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<p>The base class implementation just returns the kwargs as they are, but derived classes
might want to override this if they need to do something more sophisticated with them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.process">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.process"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.process" title="Permalink to this definition"></a></dt>
<dd><p>Process the config dict and return a PSF instance.</p>
<p>As the PSF class is an abstract base class, the returned type will in fact be some
subclass of PSF according to the contents of the config dict.</p>
<p>The provided config dict is typically the ‘psf’ field in the base config dict in
a YAML file, although for compound PSF types, it may be the field for just one of
several components.</p>
<p>This function merely creates a “blank” PSF object.  It does not actually do any
part of the solution yet.  Typically this will be followed by fit:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">PSF</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stars</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="n">pointing</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="n">pointing</span><span class="p">)</span>
</pre></div>
</div>
<p>at which point, the <code class="docutils literal notranslate"><span class="pre">psf</span></code> instance would have a solution to the PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – A dict specifying what type of PSF to build along with the
appropriate kwargs for building it.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a PSF instance of the appropriate type.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.read">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.read" title="Permalink to this definition"></a></dt>
<dd><p>Read a PSF object from a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> – The name of the file to read.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a PSF instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.readWCS">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">readWCS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.readWCS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.readWCS" title="Permalink to this definition"></a></dt>
<dd><p>Read the WCS information from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>wcs, pointing where wcs is a dict of galsim.BaseWCS instances and
pointing is a galsim.CelestialCoord instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.reflux">
<span class="sig-name descname"><span class="pre">reflux</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.reflux"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.reflux" title="Permalink to this definition"></a></dt>
<dd><p>Fit the PSF to the star’s data, varying only the flux (and
center, if it is free).  Flux and center are updated in the Star’s
attributes.  This is a single-step solution if only solving for flux,
otherwise an iterative operation.  DOF in the result assume
only flux (&amp; center) are free parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>New Star instance, with updated flux, center, chisq, dof</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.reflux_stars">
<span class="sig-name descname"><span class="pre">reflux_stars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.reflux_stars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.reflux_stars" title="Permalink to this definition"></a></dt>
<dd><p>Calculate new flux and possibly center for a list of stars</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.remove_outliers">
<span class="sig-name descname"><span class="pre">remove_outliers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.remove_outliers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.remove_outliers" title="Permalink to this definition"></a></dt>
<dd><p>Look for and flag outliers from the list of stars</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The complete list of stars to consider</p></li>
<li><p><strong>iteration</strong> – The number of the iteration that was just completed.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>new_stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.set_num">
<span class="sig-name descname"><span class="pre">set_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.set_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.set_num" title="Permalink to this definition"></a></dt>
<dd><p>If there are multiple components involved in the fit, set the number to use
for this model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.single_iteration">
<span class="sig-name descname"><span class="pre">single_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.single_iteration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.single_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Perform a single iteration of the solver.</p>
<p>Note that some object might fail at some point in the fitting, so some objects can be
flagged as bad during this step, prior to the outlier rejection step.  This information
is reported in the return tuple as nremoved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The list of stars to use for constraining the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress.</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  If not None, it should be the
same length as stars.</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If None,
use the default method for the PSF model being fit.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an updated list of all_stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.write" title="Permalink to this definition"></a></dt>
<dd><p>Write a PSF object to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> – The name of the file to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.PSF.writeWCS">
<span class="sig-name descname"><span class="pre">writeWCS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.writeWCS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.PSF.writeWCS" title="Permalink to this definition"></a></dt>
<dd><p>Write the WCS information to a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to write to</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="the-simple-case-of-one-model-interp">
<h2>The simple case of one model/interp<a class="headerlink" href="#the-simple-case-of-one-model-interp" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="piff.SimplePSF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">piff.</span></span><span class="sig-name descname"><span class="pre">SimplePSF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outliers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chisq_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF" title="Permalink to this definition"></a></dt>
<dd><p>A PSF class that uses a single model and interpolator.</p>
<p>A SimplePSF is built from a Model and an Interp object.
The model defines the functional form of the surface brightness profile, and the
interpolator defines how the parameters of the model vary across the field of view.</p>
<p>Use type name “Simple” in a config field to use this psf type, or leave off the type
name, as this is the default PSF type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – A Model instance used for modeling the surface brightness profile.</p></li>
<li><p><strong>interp</strong> – An Interp instance used to interpolate across the field of view.</p></li>
<li><p><strong>outliers</strong> – Optionally, an Outliers instance used to remove outliers.
[default: None]</p></li>
<li><p><strong>chisq_thresh</strong> – Change in reduced chisq at which iteration will terminate.
[default: 0.1]</p></li>
<li><p><strong>max_iter</strong> – Maximum number of iterations to try. [default: 30]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF._finish_write">
<span class="sig-name descname"><span class="pre">_finish_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF._finish_write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF._finish_write" title="Permalink to this definition"></a></dt>
<dd><p>Finish the writing process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF._finish_read">
<span class="sig-name descname"><span class="pre">_finish_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF._finish_read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF._finish_read" title="Permalink to this definition"></a></dt>
<dd><p>Finish the reading process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SimplePSF.fit_center">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fit_center</span></span><a class="headerlink" href="#piff.SimplePSF.fit_center" title="Permalink to this definition"></a></dt>
<dd><p>Whether to fit the center of the star in reflux.</p>
<p>This is generally set in the model specifications.
If all component models includes a shift, then this is False.
Otherwise it is True.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SimplePSF.include_model_centroid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">include_model_centroid</span></span><a class="headerlink" href="#piff.SimplePSF.include_model_centroid" title="Permalink to this definition"></a></dt>
<dd><p>Whether a model that we want to center can have a non-zero centroid during iterations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.initialize_params">
<span class="sig-name descname"><span class="pre">initialize_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.initialize_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.initialize_params" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the psf solver to begin an iterative solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The initial list of Star instances that will be used to constrain
the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress. [default: None]</p></li>
<li><p><strong>default_init</strong> – The default initilization method if the user doesn’t specify one.
[default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the initialized stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.interpolateStar">
<span class="sig-name descname"><span class="pre">interpolateStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.interpolateStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.interpolateStar" title="Permalink to this definition"></a></dt>
<dd><p>Update the star to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>star</strong> – Star instance to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.interpolateStarList">
<span class="sig-name descname"><span class="pre">interpolateStarList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.interpolateStarList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.interpolateStarList" title="Permalink to this definition"></a></dt>
<dd><p>Update the stars to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stars</strong> – List of Star instances to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of Star instances with their fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.parseKwargs">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parseKwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.parseKwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.parseKwargs" title="Permalink to this definition"></a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.set_num">
<span class="sig-name descname"><span class="pre">set_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.set_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.set_num" title="Permalink to this definition"></a></dt>
<dd><p>If there are multiple components involved in the fit, set the number to use
for this model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SimplePSF.single_iteration">
<span class="sig-name descname"><span class="pre">single_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.single_iteration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SimplePSF.single_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Perform a single iteration of the solver.</p>
<p>Note that some object might fail at some point in the fitting, so some objects can be
flagged as bad during this step, prior to the outlier rejection step.  This information
is reported in the return tuple as nremoved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The list of stars to use for constraining the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress.</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  If not None, it should be the
same length as stars.</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If None,
use the default method for the PSF model being fit.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an updated list of all_stars, nremoved</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="using-a-separate-solution-for-each-chip">
<h2>Using a separate solution for each chip<a class="headerlink" href="#using-a-separate-solution-for-each-chip" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="piff.SingleChipPSF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">piff.</span></span><span class="sig-name descname"><span class="pre">SingleChipPSF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">single_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nproc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF" title="Permalink to this definition"></a></dt>
<dd><p>A PSF class that uses a separate PSF solution for each chip</p>
<p>Use type name “SingleChip” in a config field to use this psf type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>single_psf</strong> – A PSF instance to use for the PSF solution on each chip.
(This will be turned into nchips copies of the provided object.)</p></li>
<li><p><strong>nproc</strong> – How many multiprocessing processes to use for running multiple
chips at once. [default: 1]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF._finish_write">
<span class="sig-name descname"><span class="pre">_finish_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF._finish_write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF._finish_write" title="Permalink to this definition"></a></dt>
<dd><p>Finish the writing process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF._finish_read">
<span class="sig-name descname"><span class="pre">_finish_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF._finish_read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF._finish_read" title="Permalink to this definition"></a></dt>
<dd><p>Finish the reading process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF.fit" title="Permalink to this definition"></a></dt>
<dd><p>Fit interpolated PSF model to star data using standard sequence of operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>wcs</strong> – A dict of WCS solutions indexed by chipnum.</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord object giving the telescope pointing.
[Note: pointing should be None if the WCS is not a CelestialWCS]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  This is used by composite PSFs
to isolate the effect of just this model component.  If provided,
it should be the same length as stars. [default: None]</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If not given,
use the default method for the PSF model being fit. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SingleChipPSF.fit_center">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fit_center</span></span><a class="headerlink" href="#piff.SingleChipPSF.fit_center" title="Permalink to this definition"></a></dt>
<dd><p>Whether to fit the center of the star in reflux.</p>
<p>This is generally set in the model specifications.
If all component models includes a shift, then this is False.
Otherwise it is True.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SingleChipPSF.include_model_centroid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">include_model_centroid</span></span><a class="headerlink" href="#piff.SingleChipPSF.include_model_centroid" title="Permalink to this definition"></a></dt>
<dd><p>Whether a model that we want to center can have a non-zero centroid during iterations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF.interpolateStar">
<span class="sig-name descname"><span class="pre">interpolateStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.interpolateStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF.interpolateStar" title="Permalink to this definition"></a></dt>
<dd><p>Update the star to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>star</strong> – Star instance to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF.parseKwargs">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parseKwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.parseKwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF.parseKwargs" title="Permalink to this definition"></a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SingleChipPSF.set_num">
<span class="sig-name descname"><span class="pre">set_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.set_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SingleChipPSF.set_num" title="Permalink to this definition"></a></dt>
<dd><p>If there are multiple components involved in the fit, set the number to use
for this model.</p>
</dd></dl>

</dd></dl>

</section>
<section id="composite-psf-types">
<h2>Composite PSF types<a class="headerlink" href="#composite-psf-types" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="piff.SumPSF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">piff.</span></span><span class="sig-name descname"><span class="pre">SumPSF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">components</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outliers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chisq_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF" title="Permalink to this definition"></a></dt>
<dd><p>A PSF class that is the Sum of two or more other PSF types.</p>
<p>A SumPSF is built from an ordered list of other PSFs.</p>
<p>When fitting the Sum, the default pattern is that all components after the first one
are initialized to zero, and the first component is fit as usual, but just using a
single iteration of the fit.  Then the residuals of this model are fit using the second
component, and so on.  Once all components are fit, outliers may be rejected, and then
the process is iterated.</p>
<p>This pattern can be tweaked somewhat using the initialization options available to
PSF models.  If a component should be initialized to something other than a zero model,
then one should explicitly set it.</p>
<p>Use type name “Sum” in a config field to use this psf type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>components</strong> – A list of PSF instances defining the components to be summed.</p></li>
<li><p><strong>outliers</strong> – Optionally, an Outliers instance used to remove outliers.
[default: None]</p></li>
<li><p><strong>chisq_thresh</strong> – Change in reduced chisq at which iteration will terminate.
[default: 0.1]</p></li>
<li><p><strong>max_iter</strong> – Maximum number of iterations to try. [default: 30]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF._finish_write">
<span class="sig-name descname"><span class="pre">_finish_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF._finish_write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF._finish_write" title="Permalink to this definition"></a></dt>
<dd><p>Finish the writing process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF._finish_read">
<span class="sig-name descname"><span class="pre">_finish_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF._finish_read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF._finish_read" title="Permalink to this definition"></a></dt>
<dd><p>Finish the reading process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SumPSF.fit_center">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fit_center</span></span><a class="headerlink" href="#piff.SumPSF.fit_center" title="Permalink to this definition"></a></dt>
<dd><p>Whether to fit the center of the star in reflux.</p>
<p>This is generally set in the model specifications.
If all component models includes a shift, then this is False.
Otherwise it is True.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.SumPSF.include_model_centroid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">include_model_centroid</span></span><a class="headerlink" href="#piff.SumPSF.include_model_centroid" title="Permalink to this definition"></a></dt>
<dd><p>Whether a model that we want to center can have a non-zero centroid during iterations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.initialize_params">
<span class="sig-name descname"><span class="pre">initialize_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.initialize_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.initialize_params" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the psf solver to begin an iterative solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The initial list of Star instances that will be used to constrain
the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress. [default: None]</p></li>
<li><p><strong>default_init</strong> – The default initilization method if the user doesn’t specify one.
[default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the initialized stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.interpolateStar">
<span class="sig-name descname"><span class="pre">interpolateStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.interpolateStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.interpolateStar" title="Permalink to this definition"></a></dt>
<dd><p>Update the star to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>star</strong> – Star instance to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.interpolateStarList">
<span class="sig-name descname"><span class="pre">interpolateStarList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.interpolateStarList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.interpolateStarList" title="Permalink to this definition"></a></dt>
<dd><p>Update the stars to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stars</strong> – List of Star instances to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of Star instances with their fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.parseKwargs">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parseKwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.parseKwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.parseKwargs" title="Permalink to this definition"></a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.set_num">
<span class="sig-name descname"><span class="pre">set_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.set_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.set_num" title="Permalink to this definition"></a></dt>
<dd><p>If there are multiple components involved in the fit, set the number to use
for this model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.setup_params">
<span class="sig-name descname"><span class="pre">setup_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.setup_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.setup_params" title="Permalink to this definition"></a></dt>
<dd><p>Make sure the stars have the right shape params object</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.SumPSF.single_iteration">
<span class="sig-name descname"><span class="pre">single_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/sumpsf.html#SumPSF.single_iteration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.SumPSF.single_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Perform a single iteration of the solver.</p>
<p>Note that some object might fail at some point in the fitting, so some objects can be
flagged as bad during this step, prior to the outlier rejection step.  This information
is reported in the return tuple as nremoved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The list of stars to use for constraining the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress.</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  If not None, it should be the
same length as stars.</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If None,
use the default method for the PSF model being fit.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an updated list of all_stars, nremoved</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="piff.ConvolvePSF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">piff.</span></span><span class="sig-name descname"><span class="pre">ConvolvePSF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">components</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outliers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chisq_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF" title="Permalink to this definition"></a></dt>
<dd><p>A PSF class that is the Convolution of two or more other PSF types.</p>
<p>A ConvolvePSF is built from an ordered list of other PSFs.</p>
<p>When fitting the convolution, the default pattern is that all components after the first one
are initialized as (approximately) a delta function, and the first component is fit as usual,
but just using a single iteration of the fit. Then the residuals of this model are fit using
the second component, and so on. Once all components are fit, outliers may be rejected, and
then the process is iterated.</p>
<p>This pattern can be tweaked somewhat using the initialization options available to
PSF models. If a component should be initialized to something other than a delta-function.
then one should explicitly set it.</p>
<p>Use type name “Convolve” in a config field to use this psf type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>components</strong> – A list of PSF instances defining the components to be convolved.</p></li>
<li><p><strong>outliers</strong> – Optionally, an Outliers instance used to remove outliers.
[default: None]</p></li>
<li><p><strong>chisq_thresh</strong> – Change in reduced chisq at which iteration will terminate.
[default: 0.1]</p></li>
<li><p><strong>max_iter</strong> – Maximum number of iterations to try. [default: 30]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF._finish_write">
<span class="sig-name descname"><span class="pre">_finish_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF._finish_write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF._finish_write" title="Permalink to this definition"></a></dt>
<dd><p>Finish the writing process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF._finish_read">
<span class="sig-name descname"><span class="pre">_finish_read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF._finish_read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF._finish_read" title="Permalink to this definition"></a></dt>
<dd><p>Finish the reading process with any class-specific steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The base name of the extension to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.ConvolvePSF.fit_center">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fit_center</span></span><a class="headerlink" href="#piff.ConvolvePSF.fit_center" title="Permalink to this definition"></a></dt>
<dd><p>Whether to fit the center of the star in reflux.</p>
<p>This is generally set in the model specifications.
If all component models includes a shift, then this is False.
Otherwise it is True.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="piff.ConvolvePSF.include_model_centroid">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">include_model_centroid</span></span><a class="headerlink" href="#piff.ConvolvePSF.include_model_centroid" title="Permalink to this definition"></a></dt>
<dd><p>Whether a model that we want to center can have a non-zero centroid during iterations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.initialize_params">
<span class="sig-name descname"><span class="pre">initialize_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.initialize_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.initialize_params" title="Permalink to this definition"></a></dt>
<dd><p>Initialize the psf solver to begin an iterative solution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The initial list of Star instances that will be used to constrain
the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress. [default: None]</p></li>
<li><p><strong>default_init</strong> – The default initilization method if the user doesn’t specify one.
[default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the initialized stars, nremoved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.interpolateStar">
<span class="sig-name descname"><span class="pre">interpolateStar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">star</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.interpolateStar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.interpolateStar" title="Permalink to this definition"></a></dt>
<dd><p>Update the star to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>star</strong> – Star instance to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Star instance with its fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.interpolateStarList">
<span class="sig-name descname"><span class="pre">interpolateStarList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.interpolateStarList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.interpolateStarList" title="Permalink to this definition"></a></dt>
<dd><p>Update the stars to have the current interpolated fit parameters according to the
current PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stars</strong> – List of Star instances to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of Star instances with their fit parameters updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.parseKwargs">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parseKwargs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.parseKwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.parseKwargs" title="Permalink to this definition"></a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.set_num">
<span class="sig-name descname"><span class="pre">set_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.set_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.set_num" title="Permalink to this definition"></a></dt>
<dd><p>If there are multiple components involved in the fit, set the number to use
for this model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.setup_params">
<span class="sig-name descname"><span class="pre">setup_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.setup_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.setup_params" title="Permalink to this definition"></a></dt>
<dd><p>Make sure the stars have the right shape params object</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="piff.ConvolvePSF.single_iteration">
<span class="sig-name descname"><span class="pre">single_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_funcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/convolvepsf.html#ConvolvePSF.single_iteration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.ConvolvePSF.single_iteration" title="Permalink to this definition"></a></dt>
<dd><p>Perform a single iteration of the solver.</p>
<p>Note that some object might fail at some point in the fitting, so some objects can be
flagged as bad during this step, prior to the outlier rejection step.  This information
is reported in the return tuple as nremoved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – The list of stars to use for constraining the PSF.</p></li>
<li><p><strong>logger</strong> – A logger object for logging progress.</p></li>
<li><p><strong>convert_funcs</strong> – An optional list of function to apply to the profiles being fit
before drawing it onto the image.  If not None, it should be the
same length as stars.</p></li>
<li><p><strong>draw_method</strong> – The method to use with the GalSim drawImage command. If None,
use the default method for the PSF model being fit.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an updated list of all_stars, nremoved</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="interp.html" class="btn btn-neutral float-left" title="Interpolation Schemes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="outliers.html" class="btn btn-neutral float-right" title="Removing Outliers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>