<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stars &mdash; Piff 1.3.3 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Utility Functions" href="util.html" />
    <link rel="prev" title="Output statistics" href="stats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Piff
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">PIFF: PSFs In the Full FOV</a></li>
<li class="toctree-l1"><a class="reference internal" href="piffify.html">The piffify executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Reading in Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="select.html">Selecting Good PSF Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="interp.html">Interpolation Schemes</a></li>
<li class="toctree-l1"><a class="reference internal" href="psf.html">PSF classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="outliers.html">Removing Outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Writing the output file</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">Output statistics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utility Functions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Piff</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Stars</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/star.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="stars">
<h1>Stars<a class="headerlink" href="#stars" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#piff.Star" title="piff.Star"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Star</span></code></a> class is mostly an implementation detail that users won’t need to know, but for
more advanced usage, it may be helpful to use the <a class="reference internal" href="#piff.Star" title="piff.Star"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Star</span></code></a> objects directly.</p>
<dl class="py class">
<dt id="piff.Star">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">piff.</span></code><code class="sig-name descname"><span class="pre">Star</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star" title="Permalink to this definition">¶</a></dt>
<dd><p>Information about a “star”, which may be either a real star or an interpolated star
at some target location.</p>
<p>The Star object is the fundamental way that Piff keeps track of information connected to
a particular observation location.  This includes both the input data (postage stamp image,
position on the detector, position in the field of view, weight image, etc.) and derived
information connected to whatever Model is being used</p>
<p>Stars are not normally constructed directly by the user.  They are built by various
Piff functions such as:</p>
<blockquote>
<div><p>stars = input_handler.makeStars(logger)
stars, wcs = piff.Input.process(config[‘input’])
target_star = piff.Star.makeTarget(x=x, y=y, wcs=wcs, …)</p>
</div></blockquote>
<p>However, a star can be constructed directly from a StarData instance and a StarFit instance.
The former keeps track of the data about the star (either as observed or the model at a
location) and the latter keeps track of fitted parameters related to fitting the data to
a model.</p>
<blockquote>
<div><p>star = piff.Star(star_data, star_fit)</p>
</div></blockquote>
<p>Stars have an immutable design, so any functions that change either the data or the fitted
parameters return a new object and  don’t change the original.  e.g.</p>
<blockquote>
<div><p>star = psf.drawStar(star)
star = star.reflux()
star = star.addPoisson(gain=gain)</p>
</div></blockquote>
<p>Stars have the following attributes:</p>
<blockquote>
<div><p>star.data       The component StarData object
star.fit        The component StarFit object</p>
</div></blockquote>
<p>and the following read-only properties:</p>
<blockquote>
<div><p>star.image      The image of the star
star.weight     The weight map connected to the image data
star.image_pos  The position of the star in image coordinates, aka (x,y)
star.field_pos  The position of the star in field coordinates, aka (u,v)
star.x          The x position of the star in image coordinates
star.y          The y position of the star in image coordinates
star.u          The u position of the star in field coordinates
star.v          The v position of the star in field coordinates
star.chipnum    The chip number where this star was observed (or would be observed)
star.flux       The flux of the object
star.center     The nominal center of the object (not necessarily the centroid)
star.is_reserve Whether the star is reserved from being used to fit the PSF
star.hsm        HSM measurements for this star as a tuple: (flux, cenu, cenv, sigma, g1, g2, flag)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A StarData instance (invariant)</p></li>
<li><p><strong>fit</strong> – A StarFit instance (invariant)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="piff.Star.addPoisson">
<code class="sig-name descname"><span class="pre">addPoisson</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.addPoisson"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.addPoisson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new Star with the weight values altered to reflect
Poisson shot noise from a signal source, e.g. when the weight
only contains variance from background and read noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal</strong> – The signal (as a Star instance) from which the Poisson variance is
extracted.  If None, the data image is used.  All signals are
clipped from below at zero.</p></li>
<li><p><strong>gain</strong> – The gain, in e per ADU, assumed in calculating new weights.  If None
is given, then the ‘gain’ property is used, else defaults to not
adding any variance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance with updated weight array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.center_to_offset">
<code class="sig-name descname"><span class="pre">center_to_offset</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">center</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.center_to_offset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.center_to_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility routine to convert from a center position in focal plane coordinates to the
corresponding offset in image coordinates on the postage stamp image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>center</strong> – A tuple (u,v) in focal plane coordinates</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The corresponding (dx,dy) in image coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.load_images">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">load_images</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_hdu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_hdu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">badpix_hdu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sky</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.load_images"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.load_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image data into a list of Stars.</p>
<p>We don’t store the image data for Stars when we write them to a file, since that
would take up a lot of space and is usually not desired.  However, we do store the
bounds in the original image where the star was cutout, so if you want to load back in
the original data from the image file, you can do so with this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>file_name</strong> – The file with the image data for these stars.</p></li>
<li><p><strong>pointing</strong> – The pointing direction to use. [default: None]</p></li>
<li><p><strong>image_hdu</strong> – The hdu to use for the main image. [default: None, which means
either 0 or 1 as appropriate according to the compression.]</p></li>
<li><p><strong>weight_hdu</strong> – The hdu to use for the weight image. [default: None]</p></li>
<li><p><strong>badpix_hdu</strong> – The hdu to use for the bad pixel mask. [default: None]</p></li>
<li><p><strong>noise</strong> – A constant noise value to use in lieu of a weight map
[default: None]</p></li>
<li><p><strong>sky</strong> – Optional sky image or float value to subtract from the main
image. [default: None]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new list of Stars with the images information loaded.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.makeTarget">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">makeTarget</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">u</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stamp_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">48</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.makeTarget"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.makeTarget" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a target Star object with the requested properties.</p>
<p>The image will be blank (all zeros), and the properties field will match the given
input properties.</p>
<p>The input properties must have either ‘x’ and ‘y’ or ‘u’ and ‘v’.  The other pair will
be calculated from the wcs if one is provided, or you may pass in both sets of coordinates
and leave out the wcs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – The image x position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>y</strong> – The image y position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>u</strong> – The image u position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>v</strong> – The image v position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>properties</strong> – The requested properties for the target star, including any other
requested properties besides x,y,u,v.  You may also provide x,y,u,v
in this dict rather than explicitly as kwargs. [default: None]</p></li>
<li><p><strong>wcs</strong> – The requested WCS.  [optional]</p></li>
<li><p><strong>scale</strong> – If wcs is None, you may instead provide a pixel scale. [default: None]</p></li>
<li><p><strong>stamp_size</strong> – The size in each direction of the (blank) image. [default: 48]</p></li>
<li><p><strong>image</strong> – An existing image to use instead of making a new one, if desired.
[default: None; this overrides stamp_size]</p></li>
<li><p><strong>weight</strong> – An existing image to use for the weight. [default: None]</p></li>
<li><p><strong>pointing</strong> – The pointing direction to use. [default: None]</p></li>
<li><p><strong>flux</strong> – The flux of the target star. [default: 1]</p></li>
<li><p><strong>**kwargs</strong> – Additional properties can also be given as keyword arguments if that
is more convenient than populating the properties dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Star instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.offset_to_center">
<code class="sig-name descname"><span class="pre">offset_to_center</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">offset</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.offset_to_center"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.offset_to_center" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility routine to convert from an offset in image coordinates to the corresponding
center position in focal plane coordinates on the postage stamp image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>offset</strong> – A tuple (dx,dy) in image coordinates</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The corresponding (du,dv) in focal plane coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.read">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">read</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read stars from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a list of Star instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.read_coords_params">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">read_coords_params</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.read_coords_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.read_coords_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only star fit parameters and coordinates from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the arrays coords and params</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.run_hsm">
<code class="sig-name descname"><span class="pre">run_hsm</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.run_hsm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.run_hsm" title="Permalink to this definition">¶</a></dt>
<dd><p>Use HSM to measure moments of star image.</p>
<p>This usually isn’t called directly.  The results are accessible as star.hsm,
which caches the results, so repeated access is efficient.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>(flux, cenu, cenv, sigma, g1, g2, flag)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.withFlux">
<code class="sig-name descname"><span class="pre">withFlux</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.withFlux"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.withFlux" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the flux and/or center values</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flux</strong> – The new flux.  [default: None, which means keep the existing value.]</p></li>
<li><p><strong>center</strong> – The new center.  [default: None, which means keep the existing value.]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.withProperties">
<code class="sig-name descname"><span class="pre">withProperties</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.withProperties"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.withProperties" title="Permalink to this definition">¶</a></dt>
<dd><p>Set or change any properties in the star.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>**kwargs</strong> – Each named kwarg is taken to be a property to set in the returned star.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star with the given properties, but is otherwise the same as self.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.write">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">write</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.Star.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a list of stars to a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of stars to write</p></li>
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to write to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="piff.StarData">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">piff.</span></code><code class="sig-name descname"><span class="pre">StarData</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_pos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_types</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orig_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_xyuv_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarData" title="Permalink to this definition">¶</a></dt>
<dd><p>A class that encapsulates all the relevant information about an observed star.</p>
<p><strong>Class intended to be immutable once returned from the method that creates it.</strong></p>
<dl class="simple">
<dt>This includes:</dt><dd><ul class="simple">
<li><p>a postage stamp of the imaging data</p></li>
<li><p>the weight map for these pixels (zero weight means the pixel is masked or otherwise bad)</p></li>
<li><p>whether the pixel values represent flux or surface brightness</p></li>
<li><p>the pixel area on the sky</p></li>
<li><p>the position of the star on the image</p></li>
<li><p>the position of the star in the full field-of-view (local tangent plane projection)</p></li>
<li><p>possibly extra information, such as colors</p></li>
</ul>
</dd>
</dl>
<p>A StarData object can render the pixel data in one of two ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>getImage() returns the pixels as a galsim.Image.</p></li>
<li><p>getDataVector() returns the pixels as a numpy array.</p></li>
</ul>
</div></blockquote>
<p>Different use cases may prefer the data in one of these forms or the other.</p>
<dl class="simple">
<dt>A StarData object also has this property:</dt><dd><dl class="field-list simple">
<dt class="field-odd">property pixel_area</dt>
<dd class="field-odd"><p>Solid angle on sky subtended by each pixel,
in units of the uv system.</p>
</dd>
</dl>
</dd>
</dl>
<p>The other information is stored in a dict.  This dict will include at least the following
items:</p>
<blockquote>
<div><ul class="simple">
<li><p>x</p></li>
<li><p>y</p></li>
<li><p>u</p></li>
<li><p>v</p></li>
</ul>
</div></blockquote>
<p>And anything else you want to store.  e.g.</p>
<blockquote>
<div><ul class="simple">
<li><p>chipnum</p></li>
<li><p>ra</p></li>
<li><p>dec</p></li>
<li><p>color_ri</p></li>
<li><p>color_iz</p></li>
<li><p>gain</p></li>
</ul>
</div></blockquote>
<p>Any of these values may be used for interpolation.  The most typical choices would be either
(x,y) or (u,v).  The choice of what values to use is made by the interpolator.  All such
values should be either int or float values.</p>
<p>Note that the position given for the star does not have to be a proper centroid.  It is
rather just some position in image coordinates to use as the origin of the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – A postage stamp image that includes the star</p></li>
<li><p><strong>image_pos</strong> – The position in image coordinates to use as the “center” of the star.
Note: this does not have to be the centroid or anything specific about the
star.  It is merely the image position of the (0,0) coordinate for the
model’s internal coordinate system.</p></li>
<li><p><strong>weight</strong> – The corresponding weight map for that image. [default: None]</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord representing the pointing coordinate of the
exposure.  It does not have to be the exact center of the field of view.
But it should be the same for all StarData objects in the exposure.
This is required if image.wcs is a CelestialWCS, but should be None
if image.wcs is a EuclideanWCS. [default: None]</p></li>
<li><p><strong>field_pos</strong> – Optionally provide the field_pos directly, rather than calculating it from
the wcs and a pointing. [default: None]</p></li>
<li><p><strong>properties</strong> – A dict containing other properties about the star that might be of
interest. [default: None]</p></li>
<li><p><strong>property_types</strong> – A dict containing the types to use for properties if we are eventually
going to output them to a file.  (Only really necessary for any that
aren’t float.) [default: None]</p></li>
<li><p><strong>orig_weight</strong> – The original weight map prior to any additional Poisson variance being
added.  [default: None, which means use orig_weight=weight]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="piff.StarData.addPoisson">
<code class="sig-name descname"><span class="pre">addPoisson</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.addPoisson"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarData.addPoisson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarData with the weight values altered to reflect
Poisson shot noise from a signal source, e.g. when the weight
only contains variance from background and read noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal</strong> – The signal (as a Star instance) from which the Poisson variance is
extracted.  If None, the data image is used.  All signals are
clipped from below at zero.</p></li>
<li><p><strong>gain</strong> – The gain, in e per ADU, assumed in calculating new weights.  If None
is given, then the ‘gain’ property is used, else defaults to not
adding any variance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new StarData instance with updated weight array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.calculateFieldPos">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">calculateFieldPos</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.calculateFieldPos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarData.calculateFieldPos" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert from image coordinates to field coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_pos</strong> – The position in image coordinates, as a galsim.PositionD instance.</p></li>
<li><p><strong>wcs</strong> – The wcs to use to connect image coordinates with sky coordinates:</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord representing the pointing coordinate of the
exposure.  This is required if image.wcs is a CelestialWCS, but should
be None if image.wcs is a EuclideanWCS. [default: None]</p></li>
<li><p><strong>properties</strong> – If properties is provided, and the wcs is a CelestialWCS, then add
‘ra’, ‘dec’ properties (in hours, degrees respectively) based on the
sky coordinates. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a galsim.PositionD instance representing the position in field coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.getDataVector">
<code class="sig-name descname"><span class="pre">getDataVector</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.getDataVector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarData.getDataVector" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pixel data as a numpy array.</p>
<p>Also returns the weight values and the local u,v coordinates of the pixels.
Any pixels with zero weight (e.g. from masking in the original image) will not be
included in the returned arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>data_vector, weight_vector, u_vector, v_vector</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.getImage">
<code class="sig-name descname"><span class="pre">getImage</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.getImage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarData.getImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pixel data as a galsim.Image.</p>
<p>Also returns the weight image and the origin position (the position in x,y coordinates
to use as the origin of the PSF model).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>image, weight, image_pos</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="piff.StarFit">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">piff.</span></code><code class="sig-name descname"><span class="pre">StarFit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.0,</span> <span class="pre">0.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params_var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chisq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarFit" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to hold the results of fitting a Model to some StarData, or specify
the PSF interpolated to an unmeasured location.</p>
<p><strong>Class is intended to be invariant once created.</strong></p>
<p>This class can be extended
to carry information of use to a given Model instance (such as intermediate
results), but interpolators will be looking for some subset of these properties:</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>numpy vector of parameters of the PSF that apply to this star</p>
</dd>
<dt class="field-even">Params_var</dt>
<dd class="field-even"><p>numpy array of variance error parameters of the PSF</p>
</dd>
<dt class="field-odd">Flux</dt>
<dd class="field-odd"><p>flux of the star</p>
</dd>
<dt class="field-even">Center</dt>
<dd class="field-even"><p>(u,v) tuple giving position of stellar center (relative
to data.image_pos)</p>
</dd>
<dt class="field-odd">Chisq</dt>
<dd class="field-odd"><p>Chi-squared of  fit to the data (if any) with current params</p>
</dd>
<dt class="field-even">Dof</dt>
<dd class="field-even"><p>Degrees of freedom in the fit (will depend on whether last fit had
parameters free or just the flux/center).</p>
</dd>
<dt class="field-odd">A, b</dt>
<dd class="field-odd"><p>matrix, vector, giving design matrix equation for the Taylor expansion of chisq
wrt params about their current values. The alpha matrix, AT A, is also the
inverse covariance matrix of the params.</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>params</strong> – A 1d numpy array holding estimated PSF parameters</p></li>
<li><p><strong>params_var</strong> – A 1d numpy array holding estimates PSF variance error parameters</p></li>
<li><p><strong>flux</strong> – Estimated flux for this star</p></li>
<li><p><strong>center</strong> – Estimated or fixed center position (u,v) of this star relative to
the StarData.image_pos reference point.</p></li>
<li><p><strong>A</strong> – Design matrix for the quadratic dependence of chi-squared on params about
current values.  Quatratic terms is dpT AT A dp.</p></li>
<li><p><strong>b</strong> – Vector portion of design equation. Linear term of chi-squared dependence
on params about current values is -2 AT b.</p></li>
<li><p><strong>chisq</strong> – chi-squared value at current parameters.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="piff.StarFit.newParams">
<code class="sig-name descname"><span class="pre">newParams</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarFit.newParams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#piff.StarFit.newParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarFit that has the array params installed as new parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – A 1d array holding new parameters; must match size of current ones</p></li>
<li><p><strong>**kwargs</strong> – Any other additional properties for the star. Takes current flux and
center if not provided, and otherwise puts in None</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New StarFit object with altered parameters.  All chisq-related parameters
are set to None since they are no longer valid.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="stats.html" class="btn btn-neutral float-left" title="Output statistics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="util.html" class="btn btn-neutral float-right" title="Utility Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>